START ------------- kod wiadomoÅ›ci niezbÄ™dnika -------------------

{# ============================================================
   PUZZLA â€” WIADOMOÅšÄ† PO ZAKUPIE (NIEZBÄ˜DNIK SPRZEDAWCY / Jinja2)
   TRYB: PODKÅADKI (EDYTOR) vs RESZTA (WYÅšLIJ ZDJÄ˜CIA)
   WERSJA: 2026-02-13-NS-01

   WAÅ»NE: JeÅ›li zmienisz:
   - listÄ™ SKU podkÅ‚adek (external.id),
   - parametry linku do edytora,
   - domenÄ™ / Å›cieÅ¼kÄ™ edytora,
   to ZAKTUALIZUJ ten template.
============================================================ #}

{# =========START======== [SEKCJA 01] USTAWIENIA =========START======== #}
{# Baza edytora (tu ustawiasz PROD) #}
{# Aktualnie: testowy adres z Twojego przykÅ‚adu #}
{% set editor_base_url = "https://puzzla.nazwa.pl/puzzla/projekt-podkladek/editor/" %}

{# Token do edytora (jeÅ›li staÅ‚y w testach) â€” w PROD moÅ¼esz to zmieniÄ‡ wg wÅ‚asnego mechanizmu #}
{% set editor_token = "TEST123" %}

{# SKU PODKÅADEK (external.id) â€” BEZ PODK50 (hurt) #}
{% set coasters_skus = [
  "Pod_Korek-Karton_OkrÄ…gÅ‚a",
  "6x_Pod_Czarna_OkrÄ…gÅ‚a",
  "Pod_Korek-Karton_Kwadrat",
  "Pod_Beermat_OkrÄ…gÅ‚a",
  "Pod_Czarna_OkrÄ…gÅ‚a",
  "Pod_Beermat_Kwadrat",
  "Pod_Drewniana_Kwadrat",
  "Pod_Drewniana_OkrÄ…gÅ‚a",
  "6xPod_Beermat_Kwadrat",
  "Pod_Korek_Kwadrat",
  "6xPod_Korek_Kwadrat",
  "6xPod_Czarna_Kwadrat",
  "Pod_Czarna_Kwadrat"
] %}

{# Mapowanie SKU -> â€œÅ‚adna nazwaâ€ (fallback: lineItem.offer.name) #}
{% set pretty_name_by_sku = {
  "Pod_Korek-Karton_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a (korek + karton)",
  "Pod_Korek-Karton_Kwadrat": "Foto podkÅ‚adka kwadratowa (korek + karton)",
  "Pod_Beermat_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a Beermat",
  "Pod_Beermat_Kwadrat": "Foto podkÅ‚adka kwadratowa Beermat",
  "Pod_Czarna_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a (czarna tektura)",
  "Pod_Czarna_Kwadrat": "Foto podkÅ‚adka kwadratowa (czarna tektura)",
  "Pod_Drewniana_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a (drewniana)",
  "Pod_Drewniana_Kwadrat": "Foto podkÅ‚adka kwadratowa (drewniana)",
  "Pod_Korek_Kwadrat": "Foto podkÅ‚adka kwadratowa (korek naturalny)",

  "6xPod_Beermat_Kwadrat": "Komplet 6 podkÅ‚adek pod kubek (Beermat, kwadrat)",
  "6xPod_Korek_Kwadrat": "Komplet 6 podkÅ‚adek pod kubek (korek naturalny, kwadrat)",
  "6xPod_Czarna_Kwadrat": "Komplet 6 podkÅ‚adek pod kubek (czarna tektura, kwadrat)",
  "6x_Pod_Czarna_OkrÄ…gÅ‚a": "Komplet 6 podkÅ‚adek pod kubek (czarna tektura, okrÄ…g)"
} %}

{# Funkcja pomocnicza: bezpieczny int #}
{% macro to_int(v, dflt=1) -%}
  {%- set x = (v | int) -%}
  {%- if x <= 0 -%}{{ dflt }}{%- else -%}{{ x }}{%- endif -%}
{%- endmacro %}

{# =========END======== [SEKCJA 01] USTAWIENIA =========END======== #}


{# =========START======== [SEKCJA 02] POWITANIE + PÅATNOÅšÄ† =========START======== #}
{% set hour = (now|to_datetime).hour %}
{% if hour >= 18 %}
Dobry wieczÃ³r {{ order.buyer.login | default("ğŸ˜Š") }}! ğŸ˜ŠğŸ§©
{% else %}
DzieÅ„ dobry {{ order.buyer.login | default("ğŸ˜Š") }}! ğŸ˜ŠğŸ§©
{% endif %}

{% if order.payment.type == "CASH_ON_DELIVERY" %}
Super wiadomoÅ›Ä‡ â€” zabieramy siÄ™ za realizacjÄ™ Twojego zamÃ³wienia z pÅ‚atnoÅ›ciÄ… przy odbiorze ğŸ“¦ğŸ™‚
{% else %}
DziÄ™kujemy! OtrzymaliÅ›my TwojÄ… wpÅ‚atÄ™ i rozpoczynamy realizacjÄ™ zamÃ³wienia ğŸ’³âœ…
{% endif %}
{# =========END======== [SEKCJA 02] POWITANIE + PÅATNOÅšÄ† =========END======== #}


{# =========START======== [SEKCJA 03] PODSUMOWANIE (BEZ CEN) =========START======== #}
â€”
ğŸ§© **Twoje zamÃ³wienie (podsumowanie):**
{% for lineItem in order.lineItems %}
- {{ lineItem.offer.name | default("Produkt") }} Ã— {{ lineItem.quantity }}
{% endfor %}
{# =========END======== [SEKCJA 03] PODSUMOWANIE (BEZ CEN) =========END======== #}


{# =========START======== [SEKCJA 04] KLASYFIKACJA POZYCJI =========START======== #}
{% set ns = namespace(coasters=[], other=[]) %}

{% for lineItem in order.lineItems %}
  {% set sku = lineItem.offer.external.id %}
  {% if sku in coasters_skus %}
    {% set pretty = pretty_name_by_sku.get(sku, lineItem.offer.name) %}
    {% set q = (lineItem.quantity | int) %}
    {% if q <= 0 %}{% set q = 1 %}{% endif %}

    {# Link per pozycja: order + offerId + qty + buyer + token #}
    {% set editor_link = editor_base_url
      ~ "?token=" ~ editor_token
      ~ "&order=" ~ order.id
      ~ "&offerId=" ~ lineItem.offer.id
      ~ "&qty=" ~ q
      ~ "&buyer=" ~ (order.buyer.login | default(""))
    %}

    {% set ns.coasters = ns.coasters + [{
      "name": pretty,
      "qty": q,
      "sku": sku,
      "link": editor_link
    }] %}
  {% else %}
    {% set q2 = (lineItem.quantity | int) %}
    {% if q2 <= 0 %}{% set q2 = 1 %}{% endif %}
    {% set ns.other = ns.other + [{
      "name": lineItem.offer.name | default("Produkt"),
      "qty": q2
    }] %}
  {% endif %}
{% endfor %}
{# =========END======== [SEKCJA 04] KLASYFIKACJA POZYCJI =========END======== #}


{# =========START======== [SEKCJA 05] PODKÅADKI (EDYTOR) =========START======== #}
{% if ns.coasters|length > 0 %}
â€”
ğŸ§© **PodkÅ‚adki â€” projekt online**
Aby przygotowaÄ‡ podkÅ‚adki do druku, skorzystaj z edytora (osobny link dla kaÅ¼dej pozycji):

{% for it in ns.coasters %}
- {{ it.name }} Ã— {{ it.qty }}
  ğŸ‘‰ {{ it.link }}
{% endfor %}

**WaÅ¼ne o jakoÅ›ci zdjÄ™cia:**
Najlepszy efekt uzyskamy z **oryginalnych zdjÄ™Ä‡** (prosto z telefonu/aparatu).  
Komunikatory (Messenger/WhatsApp itp.) czÄ™sto pogarszajÄ… jakoÅ›Ä‡ â€” jeÅ›li moÅ¼esz, dodaj zdjÄ™cie bezpoÅ›rednio w edytorze lub wyÅ›lij jako plik.

PrzesÅ‚ane projekty realizujemy dokÅ‚adnie w takiej formie, w jakiej zostanÄ… zapisane â€” nie ingerujemy w ukÅ‚ad ani jakoÅ›Ä‡ zdjÄ™Ä‡.
{% endif %}
{# =========END======== [SEKCJA 05] PODKÅADKI (EDYTOR) =========END======== #}


{# =========START======== [SEKCJA 06] POZOSTAÅE PRODUKTY =========START======== #}
{% if ns.other|length > 0 %}
â€”
ğŸ“¸ **PozostaÅ‚e produkty â€” przeÅ›lij zdjÄ™cia**
W zamÃ³wieniu sÄ… rÃ³wnieÅ¼:
{% for it in ns.other %}
- {{ it.name }} Ã— {{ it.qty }}
{% endfor %}

JeÅ›li ktÃ³ryÅ› z powyÅ¼szych produktÃ³w wymaga personalizacji (np. dodania zdjÄ™cia), prosimy o przesÅ‚anie plikÃ³w w wiadomoÅ›ci Allegro lub mailowo: **office@puzzla.pl**

**WaÅ¼ne o jakoÅ›ci zdjÄ™Ä‡:**  
Prosimy uÅ¼ywaÄ‡ moÅ¼liwie najlepszej jakoÅ›ci plikÃ³w â€” sÅ‚aba jakoÅ›Ä‡ moÅ¼e byÄ‡ widoczna na wydruku.  
MateriaÅ‚y realizujemy dokÅ‚adnie w takiej formie, w jakiej zostanÄ… dostarczone â€” nie ingerujemy w zdjÄ™cia.
{% endif %}
{# =========END======== [SEKCJA 06] POZOSTAÅE PRODUKTY =========END======== #}


{# =========START======== [SEKCJA 07] STOPKA + KONTEKST =========START======== #}
â€”
ZamÃ³wienie zostaÅ‚o zÅ‚oÅ¼one z konta:
ğŸ‘¤ {{ order.buyer.login | default("KupujÄ…cy") }}

JeÅ›li chcesz, sprawdÅº proszÄ™, czy dane do wysyÅ‚ki sÄ… poprawne â€” dziÄ™ki temu paczka dotrze bez problemu ğŸ“¬ğŸ˜Š

Pozdrawiamy serdecznie  
ZespÃ³Å‚ Puzzla (obsÅ‚uga sklepu {{ seller.login | default("Sprzedawca") }} na Allegro) ğŸ§©

PPH Puzzla Grzegorz Borys  
ul. Walczaka 25  
66-400 GorzÃ³w Wlkp.  
tel. +48 662 827 331  
office@puzzla.pl
{# =========END======== [SEKCJA 07] STOPKA + KONTEKST =========END======== #}

<!-- KONIEC PLIKU (niezbednik_template_v2026-02-13-NS-01) -->


END ------------- kod wiadomoÅ›ci niezbÄ™dnika -------------------

----------------------------TreÅ›Ä‡ zaleÅ¼na od konta Allegro Sprzedawcy.

{% if seller.login == 'login_allegro_1' %}
    Pozdrawiamy serdecznie
    Sklep 1
    tel. 111 111 111
{% elif seller.login == 'login_allegro_2' %}
    Pozdrawiamy serdecznie
    Sklep 2
    tel.222 222 222
{% else %} {# jeÅ›li jeszcze inny login to wyÅ›wietl go #}
    Pozdrawiamy serdecznie
    {{seller.login}}
{% endif %}

----------------------------TreÅ›Ä‡ zaleÅ¼na od ID lub SKU oferty, ktÃ³ra wchodzi w skÅ‚ad zamÃ³wienia.

TreÅ›Ä‡ zaleÅ¼na od ID lub SKU oferty, ktÃ³ra wchodzi w skÅ‚ad zamÃ³wienia.
{% for lineItem in order.lineItems %}
    <b>{{ lineItem.offer.name }}</b>
    {% if lineItem.offer.id == '6207050700' %}
      JeÅ›li karta pamiÄ™ci SD jest zablokowana, moÅ¼na jÄ… odblokowaÄ‡ przesuwajÄ…c przeÅ‚Ä…cznik Lock na karcie.
    {% endif%}
    {% if lineItem.offer.external.id == 'SKU_4232' %}Przedmiot jest chwilowo niedostÄ™pny. WysyÅ‚ka moÅ¼e siÄ™ troszkÄ™ opÃ³ÅºniÄ‡. JeÅ›li to problem prosimy o kontakt.{% endif%}
{% endfor %}

----------------------------TreÅ›Ä‡ zaleÅ¼na od ID oferty, ktÃ³ra wchodzi w skÅ‚ad zamÃ³wienia (bardziej rozbudowany przykÅ‚ad).

{% for lineItem in order.lineItems %}
    <b>{{ lineItem.offer.name }}</b>
    {% if lineItem.offer.id == '11232675880' or lineItem.offer.id == '11232675881' or lineItem.offer.id == '11232675882' %}
     KupiÅ‚eÅ› ofertÄ™ o ID 11232675880 lub 11232675881 lub 11232675882.
    {% elif lineItem.offer.id == '11232675885' %}
        KupiÅ‚eÅ› ofertÄ™ o ID 11232675885.
    {% elif lineItem.offer.id == '11232675886' %}
        KupiÅ‚eÅ› ofertÄ™ o ID 11232675886.
    {% else %}
        KupiÅ‚eÅ› innÄ… ofertÄ™.
    {% endif%}
{% endfor %}

----------------------------TreÅ›Ä‡ zaleÅ¼na od aktualnej godziny (pory odpowiadania na wiadomoÅ›Ä‡).

{% set hour = (now|to_localtime).hour %}
{% if hour >= 18 or hour <= 3 %}
Dobry wieczÃ³r
{% else %}
DzieÅ„ dobry
{% endif %}

----------------------------TreÅ›Ä‡ zaleÅ¼na od dnia tygodnia.

{# zapisanie numeru dnia tygodnia pod zmiennÄ… weekday () #}
{% set weekday = (now|to_localtime).weekday() %}
{% if weekday == 0 %} {# pon. #}
  Dzisiaj jest poniedziaÅ‚ek.
{% elif weekday == 1 %} {# wt. #}
  Dzisiaj jest wtorek.
{% elif weekday == 2 %} {# Å›r. #}
  Dzisiaj jest Å›rodÄ™.
{% elif weekday == 3 %} {# czw. #}
  Dzisiaj jest czwartek.
{% elif weekday == 4 %} {# pt. #}
  Dzisiaj jest piÄ…tek.
{% elif weekday == 5 %} {# sob. #}
  Dzisiaj jest sobotÄ™.
{% elif weekday == 6 %} {# niedz. #}
  Dzisiaj jest niedzielÄ™.
{% endif %}

{% if weekday in [0,1,2,3,4] %}
pon.-pt.
{% else %}
sob.-niedz.
{% endif %}

----------------------------TreÅ›Ä‡ zaleÅ¼na od dnia Å›wiÄ…tecznego.

{% set is_today_holiday = (now|is_holiday) %}
{% if is_today_holiday %}
DziÅ› mamy Å›wiÄ™to i nie pracujemy
{% endif %}

----------------------------WyÅ›wietlenie listy przedmiotÃ³w zamÃ³wienia.

DziÄ™kujemy. KupiÅ‚eÅ› u nas nastÄ™pujÄ…ce przedmioty:
{% for lineItem in order.lineItems %}
    {{ lineItem.offer.name }} ({{lineItem.price.amount}} zÅ‚) x {{lineItem.quantity}}
{% endfor %}

----------------------------Dodanie kodu aktywacyjnego z przykÅ‚adowej grupy o nazwie "moja_grupa_kodow".

{% get_activation_code 'moja_grupa_kodow' %}

----------------------------Dodanie kodÃ³w aktywacyjnych z rÃ³Å¼nych grup kodÃ³w zaleÅ¼nych od id zakupionych ofert z uwzglÄ™dnieniem liczby zakupionych sztuk.

{% for lineItem in order.lineItems %}
    <b>{{ lineItem.offer.name }}</b>
    {% if lineItem.offer.id == '6207050700' %}
      {% for idx in range(lineItem.quantity) %}
        {% get_activation_code 'moja_grupa_kodow1' %}
      
     {% endfor %}
    {% elif lineItem.offer.id == '6207301791' %}
      {% for idx in range(lineItem.quantity) %}
        {% get_activation_code 'moja_grupa_kodow2' %}
        
      {% endfor %}
    {% endif%}
{% endfor %}

----------------------------WysÅ‚anie SMS-a na wskazany numer telefonu.

{# wysÅ‚anie sms-a na wskazany numer telefonu #}
{% send_sms '500400300' 'SprzedaÅ‚eÅ› przedmiot na Allegro.' %}
{# lub wysÅ‚anie sms-a na numer kupujÄ…cego #}
{% set sms_message =  "DziÄ™kujemy za zakupu w sklepie {0} na allegro.".format(seller.login) %}
{% send_sms order.buyer.phoneNumber sms_message %}

----------------------------WysÅ‚anie powiadomienia e-mail na wskazany adres poczty internetowej.

{# wysÅ‚anie powiadomienia e-mail na wskazany adres poczty #}
{# podajemy 3 kolejne parametry: adres email, tytuÅ‚, treÅ›Ä‡ wiadomoÅ›ci #}
{% send_email 'mojemail@example.com' 'Powiadomienia z NiezbÄ™dnika Sprzedawcy' 'SprzedaÅ‚eÅ› przedmiot.' %}

----------------------------Pobranie numerÃ³w Å›ledzenia przesyÅ‚ek dla wskazanego id zamÃ³wienia.

{% get_tracking_numbers order.id %}
{# w odpowiedzi otrzymamy strukturÄ™:
  {"shipments": [
    {
      "id": "Testowy_REhMOjEyMzQ1Njc4OTEwUEw=",
      "waybill": "Testowy_12345678910PL",
      "carrierId": "DPD",
      "carrierName": "Kurier DPD",
      "lineItems": [
          {
          "id": "ed6b4380-3108-11e9-96bc-5f220d078cf7"
          }
      ],
      "createdAt": "2019-02-18T12:07:03.353Z"
      }
    ]
  }
#}

----------------------------WysÅ‚anie Å¼Ä…dania API (GET, POST, PUT) do zewnÄ™trznego systemu.

{# pobranie historii przesyÅ‚ki z zewnÄ™trznego systemu InPost #}
{% send_request 'https://api-shipx-pl.easypack24.net/v1/tracking/521000011526025003675478' %}
{# pobranie kursÃ³w walut z zewnÄ™trznego systemu Freecurrencyapi #}
{% send_request 'https://freecurrencyapi.net/api/v2/latest?apikey=14d65cb0-6cd3-11ec-8870-1f9d0dbbebd5'%}
{# moÅ¼liwe parametry
  -method - metoda wywoÅ‚ania API. Przyjmuje wartoÅ›Ä‡ GET, POST lub PUT,
  -headers - nagÅ‚Ã³wki HTTP Å¼Ä…dania,
  -payload - przesyÅ‚ane dane w formacie JSON.
  np.
  {% send_request 'https://example.com/api/v1/' method='POST' headers={'Authorization':'Basic YWRtaW46YXBpcHdk'} payload={'order':order.id} %}
#}

----------------------------TreÅ›Ä‡ zaleÅ¼na od kraju platformy Allegro, w ktÃ³rym zÅ‚oÅ¼ono zamÃ³wienie.

{% if order.marketplace.id == "allegro-pl" %}
  zamÃ³wienie z polskiego allegro
{% elif order.marketplace.id == "allegro-cz" %}
  zamÃ³wienie z czeskiego allegro
{% elif order.marketplace.id == "allegro-sk" %}
  zamÃ³wienie ze sÅ‚owackiego allegro
{% elif order.marketplace.id == "allegro-hu" %}
  zamÃ³wienie z wÄ™gierskiego allegro
{% else %}
  zamÃ³wienie z innego kraju
  {% send_email 'sprzedawca@example.com' 'Wymagane dodanie tÅ‚umaczenia' order.marketplace.id %}
{% endif %}

----------------------------WysÅ‚anie powiadomienia SMS do sprzedawcy po sprzedaniu wybranych ofert.

{% set ns = namespace(found=false) %}
{% for lineItem in order.lineItems %}
    {% if lineItem.offer.name|lower|contains_any(['cos', 'cos innego']) %}
      {% set ns.found = true %}
    {% endif %}
{% endfor %}
 
{% if ns.found %}
    {% set sms_message = "SprzedaÅ‚eÅ› przedmiot z listy do kupujÄ…cego {0}.".format(order.buyer.login) %}
    {% send_sms '555333444' sms_message %}
{% endif %}

--------------------------------------------------------------------------------------------------------------

Podstawy korzystania z silnika szablonÃ³w:
Znaczniki szablonu:

{% ... %} do wyraÅ¼eÅ„ i instrukcji,
{{ ... }} do wyÅ›wietlenia danych kontekstu,
{# ... #} do komentarzy (nie renderowane).
Filtry:
Filtry sÅ‚uÅ¼Ä… do sekwencyjnej modyfikacji danych wejÅ›ciowych.
{{ allMessages[0].text|upper|truncate(20) }} - przykÅ‚ad wyÅ›wietlenia zmodyfikowanej treÅ›ci pierwszej wiadomoÅ›ci (wielkoÅ›Ä‡ liter zmieniona na duÅ¼e, a nastÄ™pnie tekst uciÄ™ty do 20 znakÃ³w).

Lista wbudowanych filtrÃ³w - https://jinja.palletsprojects.com/en/2.11.x/templates/#list-of-builtin-filters
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------


SKU podkÅ‚adek

OkrÄ…gÅ‚a Foto PodkÅ‚adka Korek - Karton Kubek Kubki ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Korek-Karton_OkrÄ…gÅ‚a

6 PodkÅ‚adek PodkÅ‚adki Pod Kubek ze ZdjÄ™cia FotopodkÅ‚adki z Twoim ZdjÄ™ciem
â†’ 6x_Pod_Czarna_OkrÄ…gÅ‚a

1szt Foto podkÅ‚adka pod kubki z Twoim nadrukiem zdjÄ™ciem. Korek + Karton.
â†’ Pod_Korek-Karton_Kwadrat

Foto PodkÅ‚adka Kartonowa Kubek Kubki OkrÄ…gÅ‚a 9cm ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Beermat_OkrÄ…gÅ‚a

Foto PodkÅ‚adka Kartonowa Kubek Kubki OkrÄ…gÅ‚a 9cm ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Czarna_OkrÄ…gÅ‚a

Foto PodkÅ‚adka Kartonowa Kubek Kubki Kwadrat 9cm ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Beermat_Kwadrat

Drewniana Foto PodkÅ‚adka pod Kubek z Nadrukiem Twoim ZdjÄ™ciem FotopodkÅ‚adka
â†’ Pod_Drewniana_Kwadrat

Foto PodkÅ‚adka z Korka Kubek Kubki OkrÄ…gÅ‚a 9cm ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Korek-Karton_OkrÄ…gÅ‚a

Foto PodkÅ‚adka Drewniana Kubek Kubki OkrÄ…gÅ‚a 9cm ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Drewniana_OkrÄ…gÅ‚a

podkÅ‚adki pod kubki z nadrukiem, zdjÄ™ciem, czarna tektura, zestaw 50 szt
â†’ PODK50

6 PodkÅ‚adek PodkÅ‚adki Pod Kubek ze ZdjÄ™cia FotopodkÅ‚adki z Twoim Nadrukiem
â†’ 6xPod_Beermat_Kwadrat

Korkowa Foto PodkÅ‚adka pod Kubek z Nadrukiem Twoim ZdjÄ™ciem Korek Naturalny
â†’ Pod_Korek_Kwadrat

6szt. Fot podkÅ‚adki ze zdjÄ™cia pod kubki. Naturalny korek. Plamoodporne.
â†’ 6xPod_Korek_Kwadrat

6szt Foto PodkÅ‚adki pod Kubek Kubki Kwadrat 9x9cm ze ZdjÄ™cia. FotopodkÅ‚adki
â†’ 6xPod_Czarna_Kwadrat

Foto PodkÅ‚adka Kartonowa Kubek Kubki Kwadrat 9cm ze ZdjÄ™cia. FotopodkÅ‚adka
â†’ Pod_Czarna_Kwadrat
--------------------------------------------------------------------------------------------------------------



âœ… KOD DO WKLEJENIA (NiezbÄ™dnik Sprzedawcy / Jinja2)

Wersja z peÅ‚nÄ… architekturÄ… (podkÅ‚adki + miejsce na kolejne grupy), ale na teraz aktywnie dziaÅ‚a tylko: PODKÅADKI vs RESZTA. Sekcje â€œinne grupyâ€ nie odpalÄ… siÄ™, dopÃ³ki nie uzupeÅ‚nisz ich list SKU.

{# ========START======== [SEKCJA 01] NAGÅÃ“WEK + GLOBAL CONFIG =========START======== #}
{# ============================================================
   PUZZLA â€” TEMPLATE WIADOMOÅšCI POSPRZEDAÅ»OWEJ
   NIEZBÄ˜DNIK SPRZEDAWCY (Jinja2)

   TRYB BLOKOWY, ROZWOJOWY, BEZ SPAMU
   AKTYWNE TERAZ: PODKÅADKI vs RESZTA
   GOTOWE NA PRZYSZÅOÅšÄ†: dodatkowe bloki po uzupeÅ‚nieniu SKU
============================================================ #}

{% set template_version = "2026-02-13" %}
{% set editor_version   = "2026-02-13" %}
{% set editor_base_url  = "https://TWOJ-EDYTOR-URL.TU/editor" %}

{# ------------------------------------------------------------
ğŸ” WSKAÅ¹NIK AKTUALIZACJI (czytaj przy zmianach)

TEMPLATE VERSION: {{ template_version }}
EDITOR VERSION:   {{ editor_version }}

JeÅ›li zmienisz ktÃ³rykolwiek element poniÅ¼ej â€” zaktualizuj TEMPLATE + sekcjÄ™ serwisowÄ…:
âœ“ lista SKU podkÅ‚adek / pretty_name_by_sku
âœ“ logika kompletÃ³w (np. 4x / 6x / 12x) â€” ile sztuk z 1 projektu
âœ“ parametry linku: order / offerId / slots / qty / buyer
âœ“ URL edytora (editor_base_url)
âœ“ workflow klienta / komunikaty UX / sposÃ³b wysyÅ‚ki

Standard linku:
- slots = liczba projektÃ³w do zaprojektowania (UX)
- qty   = liczba sztuk do produkcji (kopie)
------------------------------------------------------------ #}
{# ========END======== [SEKCJA 01] NAGÅÃ“WEK + GLOBAL CONFIG =========END======== #}


{# ========START======== [SEKCJA 02] SKU + MAPOWANIA =========START======== #}
{# SKU PODKÅADEK (external.id) â€” BEZ PODK50 (hurt) #}
{% set coasters_skus = [
  "Pod_Korek-Karton_OkrÄ…gÅ‚a",
  "6x_Pod_Czarna_OkrÄ…gÅ‚a",
  "Pod_Korek-Karton_Kwadrat",
  "Pod_Beermat_OkrÄ…gÅ‚a",
  "Pod_Czarna_OkrÄ…gÅ‚a",
  "Pod_Beermat_Kwadrat",
  "Pod_Drewniana_Kwadrat",
  "Pod_Drewniana_OkrÄ…gÅ‚a",
  "6xPod_Beermat_Kwadrat",
  "Pod_Korek_Kwadrat",
  "6xPod_Korek_Kwadrat",
  "6xPod_Czarna_Kwadrat",
  "Pod_Czarna_Kwadrat"
] %}

{# Mapowanie SKU -> â€œÅ‚adna nazwaâ€ (fallback: lineItem.offer.name) #}
{% set pretty_name_by_sku = {
  "Pod_Korek-Karton_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a (korek + karton)",
  "Pod_Korek-Karton_Kwadrat": "Foto podkÅ‚adka kwadratowa (korek + karton)",
  "Pod_Beermat_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a Beermat",
  "Pod_Beermat_Kwadrat": "Foto podkÅ‚adka kwadratowa Beermat",
  "Pod_Czarna_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a (czarna tektura)",
  "Pod_Czarna_Kwadrat": "Foto podkÅ‚adka kwadratowa (czarna tektura)",
  "Pod_Drewniana_OkrÄ…gÅ‚a": "Foto podkÅ‚adka okrÄ…gÅ‚a (drewniana)",
  "Pod_Drewniana_Kwadrat": "Foto podkÅ‚adka kwadratowa (drewniana)",
  "Pod_Korek_Kwadrat": "Foto podkÅ‚adka kwadratowa (korek naturalny)",

  "6xPod_Beermat_Kwadrat": "Komplet 6 podkÅ‚adek pod kubek kwadratowych Beermat",
  "6xPod_Korek_Kwadrat": "Komplet 6 podkÅ‚adek pod kubek kwadratowych (korek naturalny)",
  "6xPod_Czarna_Kwadrat": "Komplet 6 podkÅ‚adek pod kubek kwadratowych (czarna tektura)",
  "6x_Pod_Czarna_OkrÄ…gÅ‚a": "Komplet 6 podkÅ‚adek pod kubek okrÄ…gÅ‚ych (czarna tektura)"
} %}

{# Komplet = 1 projekt (1 zdjÄ™cie) -> N kopii do produkcji
   ReguÅ‚a: jeÅ›li SKU zaczyna siÄ™ od "6x" to set_size=6, inaczej 1
   (pÃ³Åºniej Å‚atwo rozszerzyÄ‡ na 4x/12x/memo bez zmiany logiki)
#}
{% set default_set_size = 1 %}

{# ======= MIEJSCE NA PRZYSZÅE GRUPY (na razie puste) =======
   DopÃ³ki listy sÄ… puste, te sekcje siÄ™ NIE URUCHOMIÄ„.
#}
{% set custom_skus = [] %}
{% set ready_skus  = [] %}
{# ========END======== [SEKCJA 02] SKU + MAPOWANIA =========END======== #}


{# ========START======== [SEKCJA 03] POWITANIE + PODSUMOWANIE =========START======== #}
{% set hour = (now|to_localtime).hour %}
{% if hour >= 22 or hour <= 4 %}
Dobry wieczÃ³r {{ order.buyer.login }} ğŸŒ™  
O widzÄ™â€¦ ktoÅ› tu nie moÅ¼e spaÄ‡ â€” a my juÅ¼ szykujemy Twoje zamÃ³wienie! ğŸ˜„
{% else %}
DzieÅ„ dobry {{ order.buyer.login }} ğŸ˜ŠğŸ§©  
DziÄ™kujemy za zamÃ³wienie â€” juÅ¼ dziaÅ‚amy!
{% endif %}

<b>Podsumowanie zamÃ³wienia:</b>
{% for lineItem in order.lineItems %}
- {{ lineItem.offer.name }} Ã— {{ lineItem.quantity }}
{% endfor %}
{# ========END======== [SEKCJA 03] POWITANIE + PODSUMOWANIE =========END======== #}


{# ========START======== [SEKCJA 04] KLASYFIKACJA + LINKI (slots/qty) =========START======== #}
{% set ns = namespace(coasters=[], other=[], custom=[], ready=[]) %}

{% for lineItem in order.lineItems %}
  {% set sku = lineItem.offer.external.id %}

  {% if sku in coasters_skus %}
    {% set pretty = pretty_name_by_sku.get(sku, lineItem.offer.name) %}

    {# Rozpoznanie kompletÃ³w 6x... (1 projekt, 6 kopii do produkcji) #}
    {% set is_set = (sku|string).startswith("6x") %}
    {% set set_size = 6 if is_set else default_set_size %}

    {# NOWY STANDARD:
       slots = liczba projektÃ³w do zaprojektowania (UX)
       qty   = liczba sztuk do produkcji (kopie)
    #}
    {% set slots_count = 1 if is_set else lineItem.quantity %}
    {% set prod_qty    = (lineItem.quantity * set_size) if is_set else lineItem.quantity %}

    {% set editor_link = editor_base_url
      ~ "?order="  ~ order.id
      ~ "&offerId=" ~ lineItem.offer.id
      ~ "&slots=" ~ slots_count
      ~ "&qty="   ~ prod_qty
      ~ "&buyer=" ~ order.buyer.login
    %}

    {% set ns.coasters = ns.coasters + [{
      "name": pretty,
      "qty": prod_qty,
      "slots": slots_count,
      "is_set": is_set,
      "set_size": set_size,
      "link": editor_link
    }] %}

  {% else %}
    {% set ns.other = ns.other + [{
      "name": lineItem.offer.name,
      "qty": lineItem.quantity
    }] %}

    {% if sku in custom_skus %}
      {% set ns.custom = ns.custom + [{"name": lineItem.offer.name, "qty": lineItem.quantity}] %}
    {% endif %}
    {% if sku in ready_skus %}
      {% set ns.ready = ns.ready + [{"name": lineItem.offer.name, "qty": lineItem.quantity}] %}
    {% endif %}
  {% endif %}
{% endfor %}
{# ========END======== [SEKCJA 04] KLASYFIKACJA + LINKI (slots/qty) =========END======== #}


{# ========START======== [SEKCJA 05] BLOK A â€” PODKÅADKI (EDYTOR) =========START======== #}
{% if ns.coasters|length > 0 %}
<hr>
<b>ğŸŸ¦ PodkÅ‚adki â€” przygotowanie projektu w edytorze</b>

ZakupiÅ‚eÅ›(aÅ›):
{% for it in ns.coasters %}
- {{ it.name }} Ã— {{ it.qty }}
  {% if it.is_set %}
  â†’ To komplet: wystarczy <b>1 projekt (1 zdjÄ™cie)</b>, a my wykonamy <b>{{ it.qty }} szt.</b>
  {% endif %}
  â†’ Link do edytora dla tej pozycji:
  {{ it.link }}
{% endfor %}

<b>Jak skorzystaÄ‡ z edytora (krÃ³tko):</b>
1) OtwÃ³rz link przy danej pozycji.  
2) Dodaj zdjÄ™cie i ustaw kadr (przesuÅ„ / powiÄ™ksz / pomniejsz).  
3) SprawdÅº podglÄ…d, zatwierdÅº i wyÅ›lij projekt.

<b>WaÅ¼ne o jakoÅ›ci zdjÄ™cia:</b>
Najlepszy efekt uzyskamy z <b>oryginalnych zdjÄ™Ä‡</b> (prosto z telefonu/aparatu).  
Komunikatory (Messenger/WhatsApp itp.) czÄ™sto automatycznie pogarszajÄ… jakoÅ›Ä‡ â€” jeÅ›li moÅ¼esz, dodaj zdjÄ™cie bezpoÅ›rednio w edytorze lub wyÅ›lij jako plik.
{% endif %}
{# ========END======== [SEKCJA 05] BLOK A â€” PODKÅADKI (EDYTOR) =========END======== #}


{# ========START======== [SEKCJA 06] BLOK B â€” RESZTA PRODUKTÃ“W =========START======== #}
{% if ns.other|length > 0 %}
<hr>
<b>ğŸŸ© PozostaÅ‚e produkty</b>

W zamÃ³wieniu sÄ… rÃ³wnieÅ¼:
{% for it in ns.other %}
- {{ it.name }} Ã— {{ it.qty }}
{% endfor %}

JeÅ›li ktÃ³ryÅ› z powyÅ¼szych produktÃ³w wymaga personalizacji (np. dodania zdjÄ™cia), prosimy o przesÅ‚anie plikÃ³w w odpowiedzi na tÄ™ wiadomoÅ›Ä‡ lub w wiadomoÅ›ci Allegro.

<b>WaÅ¼ne o jakoÅ›ci zdjÄ™cia:</b>
Najlepszy efekt uzyskamy z <b>oryginalnych zdjÄ™Ä‡</b>.  
Komunikatory czÄ™sto obniÅ¼ajÄ… jakoÅ›Ä‡ â€” jeÅ›li moÅ¼esz, wyÅ›lij zdjÄ™cia jako pliki (bez kompresji).
{% endif %}
{# ========END======== [SEKCJA 06] BLOK B â€” RESZTA PRODUKTÃ“W =========END======== #}


{# ========START======== [SEKCJA 07] STOPKA =========START======== #}
<hr>
{% if seller.login == 'login_allegro_1' %}
Pozdrawiamy serdecznie,  
Sklep 1  
tel. 111 111 111
{% elif seller.login == 'login_allegro_2' %}
Pozdrawiamy serdecznie,  
Sklep 2  
tel. 222 222 222
{% else %}
Pozdrawiam serdecznie,  
Grzegorz Borys  
Puzzla.pl â€” www.puzzla.pl
{% endif %}

<!-- KONIEC PLIKU (template_wiadomosci_posprzedazowej_v{{ template_version }} | editor_v{{ editor_version }}) -->
{# ========END======== [SEKCJA 07] STOPKA =========END======== #}


{# ========START======== [SEKCJA 08] SEKCJA SERWISOWA / ARCHIWALNA =========START======== #}
{# 
âœ… OPIS TECHNICZNY â€” TEMPLATE WIADOMOÅšCI POSPRZEDAÅ»OWEJ (NIEZBÄ˜DNIK SPRZEDAWCY)

Wersje:
- template_version: {{ template_version }}
- editor_version:   {{ editor_version }}

STANDARD LINKU:
- slots = liczba projektÃ³w do zaprojektowania (UX)
- qty   = liczba sztuk do produkcji (kopie)

Dla kompletÃ³w 6x...:
- slots = 1
- qty   = lineItem.quantity * 6

Dla zwykÅ‚ych pozycji:
- slots = lineItem.quantity
- qty   = lineItem.quantity

WzÃ³r linku:
editor_base_url + "?order=<order.id>&offerId=<offer.id>&slots=<slots>&qty=<qty>&buyer=<buyer.login>"

TRIGGERY AKTUALIZACJI:
- nowe SKU / zmiany nazw
- nowe komplety (np. 4x/12x)
- dodanie memo (duÅ¼o kafelkÃ³w) â†’ decyzja: slots vs kopie
- zmiana parametrÃ³w linku / URL edytora / workflow
#}
{# ========END======== [SEKCJA 08] SEKCJA SERWISOWA / ARCHIWALNA =========END======== #}

/* === KONIEC PLIKU â€” Template wiadomoÅ›ci posprzedaÅ¼owej (NiezbÄ™dnik Sprzedawcy, Jinja2) === */


{# ========== Opis projektu ========== #}
{# ========== Opis projektu ========== #}
{# ========== Opis projektu ========== #}
{# ========== Opis projektu ========== #}
{# ========== Opis projektu ========== #}

âœ… OPIS PROJEKTU â€” NIEZBÄ˜DNIK SPRZEDAWCY (PUZZLA)

Cel
Automatyczny mail po zakupie w NiezbÄ™dniku Sprzedawcy, ktÃ³ry:

rozpoznaje typ produktÃ³w,

prowadzi klienta przez personalizacjÄ™,

nie wprowadza w bÅ‚Ä…d przy produktach gotowych,

jest gotowy na rozbudowÄ™.

Struktura maila
ğŸ”µ PodkÅ‚adki

wykrywane po SKU

lista produktÃ³w + iloÅ›Ä‡

przy kompletach: â€1 zdjÄ™cieâ€

link do edytora

krÃ³tka instrukcja + info o jakoÅ›ci zdjÄ™Ä‡

ğŸŸ© PozostaÅ‚e produkty

lista wszystkiego co nie jest podkÅ‚adkÄ…

neutralny komunikat:
â€jeÅ›li wymagajÄ… personalizacji â€” wyÅ›lij zdjÄ™ciaâ€

Powitanie

uÅ¼ywa order.buyer.login

noc â†’ lekki humor

Podsumowanie zamÃ³wienia

lista produktÃ³w + iloÅ›ci

bez cen

Parametry edytora

Link przekazuje:

order   â†’ ID zamÃ³wienia
offerId â†’ typ produktu
qty     â†’ iloÅ›Ä‡
buyer   â†’ login klienta


Klient nic nie wpisuje rÄ™cznie.

Zasady UX

zero spamu

jasne instrukcje

klient wie co zrobiÄ‡

brak komunikatÃ³w dla produktÃ³w gotowych

Stan projektu

dziaÅ‚a podziaÅ‚: podkÅ‚adki vs reszta

architektura gotowa na kolejne grupy

edytor bÄ™dzie obsÅ‚ugiwaÅ‚ parametry URL

Koniec opisu projektu
{# =====================================================================
  ğŸ” AUTOMATYCZNY WSKAÅ¹NIK: CZY TRZEBA ZAKTUALIZOWAÄ† OPIS / TEMPLATE?
  JeÅ›li zmienisz COÅš z listy poniÅ¼ej â†’ ZAKTUALIZUJ â€œOPIS PROJEKTUâ€ oraz
  (jeÅ›li trzeba) listy SKU / mapowania / parametry linku.

  TRIGGERY AKTUALIZACJI (jeÅ›li dotyczy choÄ‡ jeden punkt):
  1) Zmiana listy SKU podkÅ‚adek (coasters_skus) lub dodanie nowego SKU.
  2) Zmiana logiki â€œkomplet 6 szt.â€ (np. prefiks 6x / inne zestawy).
  3) Zmiana parametrÃ³w linku do edytora (order/offerId/qty/buyer/token).
  4) Zmiana domeny lub Å›cieÅ¼ki edytora (editor_base_url).
  5) Zmiana mapowania produktu po stronie edytora (np. kÃ³Å‚ko/kwadrat, nowe produkty).
  6) Zmiana sposobu, jak klient wysyÅ‚a projekt (workflow/UX, komunikaty).
  7) Zmiana wersji template maila lub wersji edytora, na ktÃ³rÄ… siÄ™ powoÅ‚ujemy.

  WERSJA DOKUMENTU / TEMPLATE:
  - mail_template_version: 2026-02-13
  - opis_projektu_version: 2026-02-13
===================================================================== #}
{# END======= Opis projektu =======END #}
{# END======= Opis projektu =======END #}
{# END======= Opis projektu =======END #}
{# END======= Opis projektu =======END #}
{# END======= Opis projektu =======END #}
